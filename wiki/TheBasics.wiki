#summary The Basics
#labels FAQ

= Introduction =

This covers tasks bakert requested:
 * Hello World
 * How to put static html at a particular url
 * How to read the values submitted in a form
 * ...

= Hello World =

{{{
{-# OPTIONS -fglasgow-exts -fth -fallow-undecidable-instances #-}
import HAppS.Server.State

$(systemState ''NoState)

main = do control <- startSystemState
          simpleHTTP [method () $ ok "Hello World"]
          waitForTermination control

}}}

= Static Html =

{{{
{-# OPTIONS -fglasgow-exts -fth -fallow-undecidable-instances #-}
import HAppS.Server.State
import Text.XHtml hiding (method)
import qualified Text.XHtml as XHtml

$(systemState ''NoState)

main = do control <- startSystemState
          simpleHTTP [method () $ ok foo]
          waitForTermination control

foo = body << 
      (h1 << toHtml "HAppS is cool" +++ 
      (anchor ! [href "http://www.happs.org/"] << toHtml "HAppS")
      +++ toHtml " rocks!")
}}}

= Read and Submit data from a form = 

{{{
{-# OPTIONS -fglasgow-exts -fth -fallow-undecidable-instances #-}
import HAppS.Server.State
import Text.XHtml hiding (method)
import qualified Text.XHtml as XHtml
import Control.Monad

$(deriveAll [''Show, ''Default, ''Read, ''Eq]
  [d|
      newtype Name = Name String
   |]
 )

$(systemState ''NoState)

impl = [method GET $ ok foo
       ,withData $ \name ->
           [
            method POST $ ok $ toHtml "Hello " +++ toHtml (bar name)
           ,method () $ ok "um, what?"
           ]
       ,method () $ ok "top level huh?"
       ]

main = do control <- startSystemState
          simpleHTTP impl 
          waitForTermination control

foo = body <<
      (toHtml "What's your name?" +++
       (form ! [XHtml.method "POST"] << (input ! [strAttr "type" "text", strAttr "name" "subName"] +++ input ! [strAttr "type" "submit"]))
      )

instance FromData Name where
    fromData = do c <- look "subName" `mplus` return "noname"
                  return (Name c)


bar x = case x of (Name name) -> name
                  _           -> "no name?"
}}}